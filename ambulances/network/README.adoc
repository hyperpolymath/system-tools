= Network Ambulance
:toc:
:toclevels: 3
:icons: font
:source-highlighter: rouge

image:https://img.shields.io/badge/License-PMPL--1.0-blue.svg[License: PMPL-1.0,link="https://github.com/hyperpolymath/palimpsest-license"]
image:https://img.shields.io/badge/Philosophy-Palimpsest-indigo.svg[Palimpsest,link="https://github.com/hyperpolymath/palimpsest-license"]
image:https://img.shields.io/badge/Version-1.0.0-success.svg[Version]
image:https://img.shields.io/badge/Status-Production_Ready-brightgreen.svg[Status]

*Your Linux internet stopped working. Network Ambulance gets you back online.*

Network Ambulance is a comprehensive diagnostic and repair tool for Linux network connectivity issues. Unlike random forum advice or risky "optimizer" tools, it provides *safe, documented, reversible* network repairs with *full evidence trails*.

[quote]
____
"It's 2am, your internet is down, and you have a deadline. You don't need a networking degree‚Äîyou need Network Ambulance."
____

== The Problem

You've been there:

* WiFi connected but no internet
* "No internet connection" despite working yesterday
* DNS not resolving, pages won't load
* VPN broke your routing table
* NetworkManager conflicts with system settings
* Browser says "DNS_PROBE_FINISHED_NO_INTERNET"

You search forums. You find 50 different solutions. Half are outdated. Some are dangerous (`sudo rm -rf /etc/NetworkManager`). You don't know which to trust.

**Network Ambulance solves this.**

== What It Does

Network Ambulance provides *systematic, expert-level diagnostics and repairs* for common Linux connectivity failures‚Äîwithout requiring you to be a networking expert.

=== üîç Comprehensive Diagnostics

Network Ambulance checks *everything* that can break internet connectivity:

[cols="1,3"]
|===
|Area |What It Checks

|**DNS**
|`resolv.conf` validity, systemd-resolved status, DNS server reachability, resolution tests, cache stats

|**Network Interfaces**
|Interface status, IP configuration, MAC addresses, link state, driver info, statistics, conflicts

|**Routing**
|Default route presence, gateway reachability, IPv6 routing, policy rules, metrics, ARP table

|**Connectivity**
|ICMP ping tests, HTTP/HTTPS verification, port connectivity, MTU discovery, latency measurement

|**Firewall**
|iptables rules, nftables, UFW status, firewalld zones, policy analysis

|**Network Manager**
|NetworkManager/systemd-networkd status, active connections, device states, conflicts
|===

=== üîß Safe, Documented Repairs

When Network Ambulance finds problems, it can fix them‚Äî*safely*:

* **DNS repairs**: Fix `resolv.conf`, add reliable DNS servers, restart systemd-resolved, flush caches
* **Interface repairs**: Bring up interfaces, renew DHCP leases, fix down interfaces
* **Routing repairs**: Add missing default routes, remove duplicates, repair gateway configuration
* **NetworkManager repairs**: Restart service, reconnect, resolve conflicts, reset problematic connections

Every repair:

* ‚úì Shows you what it will do *before* doing it (dry-run mode)
* ‚úì Creates automatic backups
* ‚úì Generates receipts for audit trails
* ‚úì Can be undone if something goes wrong

== Quick Start

=== Installation

[source,bash]
----
git clone https://github.com/hyperpolymath/network-ambulance.git
cd network-ambulance
sudo ./install.sh
----

Or download and install in one command:

[source,bash]
----
curl -fsSL https://raw.githubusercontent.com/hyperpolymath/network-ambulance/main/install.sh | sudo bash
----

=== Basic Usage

==== Run Full Diagnostics

[source,bash]
----
network-repair diagnose
----

This shows you *everything* about your network state: interfaces, DNS, routing, connectivity, firewall rules, NetworkManager status.

Sample output:

[source,text]
----
[‚úì] Interface enp0s31f6: UP, no IP address (PROBLEM)
[‚úì] Interface wlp3s0: UP, 10.45.253.69/24
[‚úó] DNS: No working nameservers in /etc/resolv.conf
[‚úì] Default route via 10.45.253.205
[‚úó] Cannot reach 8.8.8.8 (PROBLEM)
[‚úó] DNS resolution failing for google.com
[!] WARNING: Multiple network managers detected (conflict)
----

==== Auto-Repair Everything

If you trust Network Ambulance to fix everything it found:

[source,bash]
----
sudo network-repair auto-repair
----

==== Guided Repair (Recommended)

For more control, use interactive mode:

[source,bash]
----
sudo network-repair repair --interactive
----

This walks you through each issue and asks what you want to do:

[source,text]
----
Issue: No DNS servers configured in /etc/resolv.conf

Suggested repair: Add Google DNS (8.8.8.8, 8.8.4.4) to resolv.conf

[Y] Apply this fix
[S] Skip
[D] Show details
[Q] Quit

Your choice:
----

==== Target Specific Problems

Fix just DNS issues:

[source,bash]
----
sudo network-repair repair dns
----

Fix just interface problems:

[source,bash]
----
sudo network-repair repair interfaces
----

Other targets: `routing`, `networkmanager`, `firewall`

==== Dry-Run Mode

See what *would* be changed without actually changing it:

[source,bash]
----
sudo network-repair repair --dry-run
----

Perfect for understanding what's wrong or verifying before production changes.

== Real-World Scenarios

=== Scenario 1: "WiFi Connected But No Internet"

This is the most common problem‚Äîyou're connected to WiFi, but browsers say "no internet".

[source,bash]
----
$ network-repair diagnose connectivity

[‚úì] Interface wlp3s0: UP, connected to "Home WiFi"
[‚úó] Cannot ping 8.8.8.8
[‚úó] Cannot resolve google.com
[!] DNS server 192.168.1.1 unreachable

$ sudo network-repair repair dns

Creating backup of /etc/resolv.conf...
Adding Google DNS (8.8.8.8)...
Adding Cloudflare DNS (1.1.1.1)...
Restarting systemd-resolved...
Testing DNS resolution... SUCCESS

[‚úì] DNS repaired. You should have internet now.
----

=== Scenario 2: "Ethernet Cable Plugged In, Not Working"

Interface is down or misconfigured.

[source,bash]
----
$ network-repair diagnose interfaces

[‚úó] Interface enp0s31f6: DOWN (no carrier)
[!] Cable may be disconnected or interface disabled

$ sudo network-repair repair interfaces --target enp0s31f6

Bringing up interface enp0s31f6...
Renewing DHCP lease...
Waiting for IP address... Got 192.168.1.105

[‚úì] Interface enp0s31f6 is now UP with IP 192.168.1.105
----

=== Scenario 3: "VPN Broke Everything"

VPN clients often mess up routing tables and DNS settings.

[source,bash]
----
$ network-repair diagnose routing

[‚úó] Multiple default routes detected (conflict)
[‚úó] Default route points to unreachable gateway 10.8.0.1

$ sudo network-repair repair routing

Removing duplicate default route via 10.8.0.1...
Adding default route via 192.168.1.1...
Flushing route cache...

[‚úì] Routing table repaired
----

=== Scenario 4: "Everything Was Fine Yesterday"

Classic "I didn't change anything" scenario. Something updated and broke networking.

[source,bash]
----
$ network-repair diagnose

[!] NetworkManager and systemd-networkd are both active (CONFLICT)
[‚úó] NetworkManager cannot manage wlp3s0 (blocked by systemd-networkd)

$ sudo network-repair repair networkmanager

Detected conflict: both NetworkManager and systemd-networkd active
Recommended: Disable systemd-networkd, let NetworkManager handle interfaces

Proceed? [y/N]: y

Stopping systemd-networkd...
Restarting NetworkManager...
Reconnecting wlp3s0...

[‚úì] Network conflict resolved
----

== Part of AmbientOps

Network Ambulance is a *procedure pack* in the link:https://github.com/hyperpolymath/ambientops[AmbientOps ecosystem], which uses a "hospital model" for system tools:

* **Ward** ‚Äî Daily ambient system health ("System Weather")
* **Emergency Room** ‚Äî Panic-safe emergency diagnostics
* **Operating Room** ‚Äî Planned procedures (Network Ambulance lives here)
* **Records** ‚Äî Receipts, undo tokens, shareable help bundles

Network Ambulance integrates with:

* **Operating Theatre** for procedure orchestration
* **Ward** for surfacing network health signals
* **Emergency Room** for network emergencies (quick handoff)
* **Records** for generating shareable incident bundles

See `docs/AMBIENTOPS_INTEGRATION.adoc` for details.

== Safety Guarantees

Network Ambulance follows *AmbientOps safety principles*:

=== ‚úì Evidence-First, Not Fearware

No "304 CRITICAL ERRORS DETECTED" scareware. Network Ambulance shows you *measurements*, not hype.

Instead of: "Your network is 97% broken!"

You get: "DNS server 192.168.1.1 unreachable. Google DNS reachable in 12ms. Suggestion: switch to Google DNS."

=== ‚úì Non-Destructive by Default

Diagnostics are *completely read-only*. No changes without your approval.

Repairs:

* Create automatic timestamped backups
* Prefer additive changes (add route, don't delete everything)
* Avoid "nuke from orbit" approaches
* Provide undo receipts

=== ‚úì Explicit Approval Required

No silent changes. Every repair shows:

* What it will do
* Why it's needed
* What can go wrong
* How to undo it

You approve each change (or use `--yes` if you're confident).

=== ‚úì Never Opens Security Holes

Network Ambulance will **NEVER**:

* Open firewall ports without explicit consent
* Disable security controls silently
* Weaken authentication
* Delete user data
* Make permanent changes without documentation

=== ‚úì Works Offline

Network Ambulance doesn't require internet to diagnose or repair network problems (obviously).

All diagnostics and most repairs work *completely offline*.

== Command Reference

[cols="2,3"]
|===
|Command |Description

|`network-repair diagnose`
|Run all diagnostics

|`network-repair diagnose <target>`
|Diagnose specific area (dns\|interfaces\|routing\|connectivity\|firewall\|networkmanager)

|`sudo network-repair repair`
|Interactive guided repair

|`sudo network-repair repair <target>`
|Repair specific area

|`sudo network-repair auto-repair`
|Automatically fix all detected issues

|`sudo network-repair repair --dry-run`
|Show what would be changed (no actual changes)

|`network-repair status`
|Quick network health check

|`network-repair list-interfaces`
|List all network interfaces

|`network-repair test-dns`
|Test DNS resolution

|`network-repair test-connectivity`
|Test internet connectivity

|`network-repair version`
|Show version info

|`network-repair help`
|Show help message
|===

=== Options

[cols="1,3"]
|===
|Option |Description

|`-v, --verbose`
|Show detailed output

|`-q, --quiet`
|Minimal output

|`-y, --yes`
|Auto-approve all changes (dangerous!)

|`--dry-run`
|Preview changes only

|`--no-color`
|Disable colored output

|`--log <file>`
|Write log to file

|`--backup-dir <dir>`
|Custom backup directory

|`--interactive`
|Guided mode (ask before each change)
|===

== Advanced Features

=== Export Incident Bundles

Generate a shareable diagnostic bundle for forums/support:

[source,bash]
----
network-repair export --bundle /tmp/network-issue
----

Creates:

[source,text]
----
/tmp/network-issue/
‚îú‚îÄ‚îÄ diagnostics.txt       # Full diagnostic output
‚îú‚îÄ‚îÄ system-info.txt       # OS, kernel, hardware
‚îú‚îÄ‚îÄ network-config/       # Config files (sanitized)
‚îÇ   ‚îú‚îÄ‚îÄ resolv.conf
‚îÇ   ‚îú‚îÄ‚îÄ NetworkManager.conf
‚îÇ   ‚îî‚îÄ‚îÄ interfaces
‚îú‚îÄ‚îÄ logs/                 # Relevant logs
‚îÇ   ‚îú‚îÄ‚îÄ networkmanager.log
‚îÇ   ‚îî‚îÄ‚îÄ syslog-network.log
‚îî‚îÄ‚îÄ metadata.json         # Machine-readable summary
----

The bundle *automatically sanitizes* sensitive info (passwords, IPs if requested).

=== Backup Management

List all backups:

[source,bash]
----
network-repair list-backups
----

Restore from backup:

[source,bash]
----
sudo network-repair restore --backup 2026-01-29_14-30-22
----

=== JSON Output

For scripting/automation:

[source,bash]
----
network-repair diagnose --format json
----

Returns structured JSON with all diagnostic results.

=== Logging

Enable file logging:

[source,bash]
----
network-repair diagnose --log /var/log/network-repair.log
----

Or set default log location:

[source,bash]
----
export NETWORK_REPAIR_LOG=/var/log/network-repair.log
----

== Distribution Support

Network Ambulance works on:

* ‚úì Ubuntu / Debian (fully supported)
* ‚úì Fedora / RHEL / CentOS (fully supported)
* ‚úì Arch Linux (fully supported)
* ‚úì openSUSE (supported)
* ‚ö† Other systemd-based distros (best-effort)

Network manager support:

* ‚úì NetworkManager (primary, fully supported)
* ‚úì systemd-networkd (supported)
* ‚ö† netplan (via NetworkManager/systemd-networkd)
* ‚úó ifupdown (legacy, limited support)

== Technical Details

=== Architecture

[source,text]
----
network-repair
‚îú‚îÄ‚îÄ src/main.sh              # CLI entry point
‚îú‚îÄ‚îÄ src/diagnostics/         # Diagnostic modules
‚îÇ   ‚îú‚îÄ‚îÄ connectivity.sh
‚îÇ   ‚îú‚îÄ‚îÄ dns.sh
‚îÇ   ‚îú‚îÄ‚îÄ firewall.sh
‚îÇ   ‚îú‚îÄ‚îÄ interfaces.sh
‚îÇ   ‚îú‚îÄ‚îÄ networkmanager.sh
‚îÇ   ‚îî‚îÄ‚îÄ routing.sh
‚îú‚îÄ‚îÄ src/repairs/             # Repair modules
‚îÇ   ‚îú‚îÄ‚îÄ dns.sh
‚îÇ   ‚îú‚îÄ‚îÄ interfaces.sh
‚îÇ   ‚îú‚îÄ‚îÄ networkmanager.sh
‚îÇ   ‚îî‚îÄ‚îÄ routing.sh
‚îî‚îÄ‚îÄ src/utils/               # Core utilities
    ‚îú‚îÄ‚îÄ backup.sh            # Backup/restore
    ‚îú‚îÄ‚îÄ colors.sh            # Terminal colors
    ‚îú‚îÄ‚îÄ logging.sh           # Logging framework
    ‚îú‚îÄ‚îÄ privileges.sh        # Root/sudo handling
    ‚îî‚îÄ‚îÄ system.sh            # OS detection
----

=== Requirements

* Bash 4.0+
* Standard Linux utilities: `ip`, `ping`, `dig`, `curl`
* NetworkManager or systemd-networkd (optional but recommended)
* Root/sudo for repairs (diagnostics work without root)

=== Implementation Language

Network Ambulance v1.x is implemented in *Bash* for maximum portability and minimal dependencies.

Future versions may use:

* **D** for core orchestration (robust, cross-distro)
* **Rust** for privileged operations (safety-critical paths)

Per Rhodium Standard Repository (RSR) guidelines.

== Why Network Ambulance?

=== vs. Manual Forum Fixes

|===
|Manual Fixes |Network Ambulance

|Search 10 forum threads
|One command

|Copy-paste random commands
|Safe, tested procedures

|Hope it works
|Evidence-based diagnostics

|No undo if it breaks
|Automatic backups + undo

|"Works on Ubuntu 16.04"
|Works on modern distros

|Might delete something important
|Never deletes data
|===

=== vs. "Network Optimizer" Tools

Those sketchy "Clean your network!" tools?

* They lie about problems to scare you
* They open security holes
* They install adware/spyware
* They want your credit card

Network Ambulance:

* ‚úì Open source (review the code)
* ‚úì No telemetry, no tracking
* ‚úì No "premium upsells"
* ‚úì Evidence-based, no fake errors
* ‚úì Safety-first design

=== vs. Learning Everything Yourself

Learning networking is great, but when your deadline is in 2 hours and your internet is down, you don't have time for a CCNA course.

Network Ambulance is *teaching-friendly*:

* Explains what it finds in plain English
* Shows the commands it runs
* Documents why each fix works
* References are included (learn at your own pace)

You can learn while fixing, not instead of fixing.

== Roadmap

=== v1.1 (Q1 2026)

* Wireless-specific diagnostics (signal strength, channel interference)
* VPN detection and diagnostics
* Improved conflict detection (multiple network managers)
* Enhanced logging and reporting

=== v1.2 (Q2 2026) üéØ **Current Target**

* Firewall repair module (safe UFW/firewalld configuration)
* systemd-networkd advanced features
* Plugin architecture (beta)
* Test coverage >90%
* Captive portal detection
* Proxy configuration diagnostics

See link:ROADMAP.adoc[ROADMAP.adoc] for the complete roadmap to v1.2 and beyond.

== Contributing

We welcome contributions! See link:CONTRIBUTING.adoc[CONTRIBUTING.adoc].

Priority areas for v1.2:

* Firewall repair safety checks
* Captive portal detection
* Proxy diagnostics
* Test coverage improvements
* Documentation for additional distros

== Support

* Issues: https://github.com/hyperpolymath/network-ambulance/issues
* Discussions: https://github.com/hyperpolymath/network-ambulance/discussions
* Security issues: See link:SECURITY.md[SECURITY.md]

== License

Network Ambulance is licensed under PMPL-1.0-or-later (Palimpsest Meta-Permissive License).

See link:LICENSE[LICENSE] for details.

== Philosophy

Network Ambulance follows the link:https://github.com/hyperpolymath/palimpsest-license[Palimpsest philosophy]:

* **Boring is good** ‚Äî Reliable, predictable, no surprises
* **Evidence over hype** ‚Äî Show measurements, not marketing
* **Safety-first** ‚Äî Never break what's working
* **Respect users** ‚Äî No dark patterns, no manipulation
* **Open by default** ‚Äî Audit anything, trust nothing

[quote]
____
"The best system tool is the one you never notice‚Äîuntil you desperately need it, and it just works."
____

---

Made with care by the link:https://github.com/hyperpolymath[Hyperpolymath Project].
